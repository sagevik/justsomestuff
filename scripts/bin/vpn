#!/bin/sh

# Launch new foot terminal for connecting to VPN

# foot --title "VPN" sh -c "echo \"Connecting to VPN\" && sudo gpclient --ignore-tls-errors --fix-openssl connect gp.norsvin.no"

foot --app-id "GlobalProtect_VPN" --title "GlobalProtect_VPN" sh -c '
    if tmux has-session -t GlobalProtect_VPN 2>/dev/null; then
        # Attach to existing session
        tmux attach -t GlobalProtect_VPN
    else
        # Create new session and run VPN setup
        tmux new-session -s GlobalProtect_VPN "
            green=\"\033[32m\";
            white=\"\033[97m\";
            reset=\"\033[0m\";

            printf \"%b--------------------------------------%b\n\" \"\$green\" \"\$reset\";
            printf \"%b---%b  %bConnect to GlobalProtect VPN%b  %b---%b\n\" \"\$green\" \"\$reset\" \"\$white\" \"\$reset\" \"\$green\" \"\$reset\";
            printf \"%b--------------------------------------%b\n\" \"\$green\" \"\$reset\";

            sudo gpclient --ignore-tls-errors --fix-openssl connect gp.norsvin.no;

            # Automatically close tmux session when gpclient exits
            exit
        "
    fi
'
